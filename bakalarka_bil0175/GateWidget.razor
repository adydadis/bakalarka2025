@using Blazor.Diagrams.Components.Renderers
@using bakalarka_bil0175
@using Blazor.Diagrams.Core.Models
@using Blazor.Diagrams

<div class="gate-container"
     style="position: relative;
         background: white;
         padding: 8px;
         min-width: 90px;
         text-align: center;
         border: 2px solid @(Node.IsNegatedVersion ? "#dc3545" : "#007bff");
     border-radius: @(Node.IsNegatedVersion ? "0px" : "12px");
     box-shadow: 0px @(Node.IsNegatedVersion ? "0px" : "4px") 2px rgba(0,0,0,0.1);">

    @*SMAZAT*@
    <button @onclick="Delete"
            @onclick:stopPropagation="true"
            style="position: absolute; top: -8px; right: -8px; background: #dc3545; color: white; border:1px solid #a71d2a; width: 20px; height: 20px; font-size: 12px; cursor: pointer; font-weight: bold; z-index: 10; display: flex; align-items: center; justify-content: center;">
        X
    </button>

    @*Porty*@
    <div style="position: absolute; left: -10px; top: 0; bottom: 0; display: flex; flex-direction: column; justify-content: space-around;">
        @foreach (var port in Node.Ports.Where(p => p.Alignment == PortAlignment.Left))
        {
            <PortRenderer Port="port">
                <div style="width: 18px; height: 18px; background: #555; border-radius: 50%; border: 2px solid white; cursor: crosshair;"></div>
            </PortRenderer>
        }
    </div>
    
    <div style="position: absolute; right: -10px; top: 0; bottom: 0; display: flex; flex-direction: column; justify-content: space-around;">
        @foreach (var port in Node.Ports.Where(p => p.Alignment == PortAlignment.Right))
        {
            <PortRenderer Port="port">
                <div style="width: 14px; height: 14px; background: #555; border-radius: 50%; border: 2px solid white; cursor: crosshair;"></div>
            </PortRenderer>
        }
    </div>

    <strong style="font-size: 1.4em; color: @(Node.IsNegatedVersion ? "#dc3545" : "#007bff");">
        @Node.Label
    </strong>

    @*Status*@
    <div style="font-size: 0.9em; font-weight: bold; border-top: 1px solid #eee; width: 100%; padding-top: 2px;">
        @(Node.Status == NodeState.True ? "1" : "0")
    </div>

        @if (Node.GateType == "START" && !Node.IsNegatedVersion)
        {
            <button @onclick="changeValue"
                    @onclick:stopPropagation="true"
                    class="btn btn-sm btn-dark"
                    style="width: 100%; margin-top: 10px; font-weight: bold; font-size: 0.75rem;">
                Zmenit stav
            </button>
        }
    

 
</div>

@code {
    [Parameter] public GateNode Node { get; set; } = null!;
    [CascadingParameter] public BlazorDiagram Diagram { get; set; } = null!;

    private void changeValue()
    {
        if (Node.GateType == "START")
        {
            
            if (Node.Label.Contains("(1)"))
            {
                Node.Label = "START (0)";
            }
            else
            {
                Node.Label = "START (1)";
            }
            
           
            Node.Refresh();
        }
    }
    
    private void Delete()
    {
        
        Diagram.Nodes.Remove(Node);
    }
}